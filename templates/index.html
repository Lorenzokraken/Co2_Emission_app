<!DOCTYPE html>
<html>
<head>
    <title>COâ‚‚ Emissions</title>
    <style>
        body {
            background-color: #6c9a8b;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background: linear-gradient(135deg, #ffffff, #6c9a8b);
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        select, button {
            margin: 10px 0;
            padding: 8px;
            font-size: 16px;
            width: 250px;
        }

        button[type="button"].add-country {
            width: 40px;
            margin-left: 5px;
            margin-right: 5px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }

        #ai-toggle-label {
            margin-top: 15px;
            font-size: 16px;
            color: #000;
        }

        .footer {
            margin-top: 20px;
            font-size: 0.85em;
            color: #4e7b6b;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Compare COâ‚‚ Emissions</h1>
        <form id="main-form" method="POST" action="/">
            <div id="countries-container">
                <label for="country1">Country 1:</label>
                <select name="country1" required>
                    {% for c in countries %}
                        <option value="{{ c.country_id }}" {% if c.name == 'United States' %}selected{% endif %}>{{ c.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="display: flex; justify-content: center; align-items: center;">
                <button type="button" class="add-country" id="add-btn" onclick="addCountrySelect()">+</button>
                <button type="button" class="add-country" id="remove-btn" onclick="removeCountrySelect()">âˆ’</button>
            </div>

            <label for="year_start">From Year:</label>
            <select name="year_start" required>
                {% for y in years %}
                    <option value="{{ y.year }}">{{ y.year }}</option>
                {% endfor %}
            </select>

            <label for="year_end">To Year:</label>
            <select name="year_end" id="year_end" required>
                {% for y in years %}
                    <option value="{{ y.year }}" {% if y.year == 1990 %}selected{% endif %}>{{ y.year }}</option>
                {% endfor %}
            </select>

            <div id="ai-toggle-label">
                <input type="checkbox" id="ai-toggle" />
                <label for="ai-toggle">ðŸ”® AI PREVISIONS</label>
            </div>

            <br><br>
            <button type="submit">Genera Grafico</button>
        </form>
    </div>

    <div class="footer">
        Creato da Lorenzo Iuliano â€“ Fonti: Our World in Data
    </div>

    <script>
        let countryCount = 1;
        const maxCountries = 5;

        const aiToggle = document.getElementById("ai-toggle");
        const yearEndSelect = document.getElementById("year_end");
        const addBtn = document.getElementById("add-btn");
        const removeBtn = document.getElementById("remove-btn");
        const container = document.getElementById("countries-container");

        function updateAIStatus() {
            if (countryCount > 1) {
                aiToggle.checked = false;
                aiToggle.disabled = true;
                aiToggle.style.opacity = 0.5;
            } else {
                aiToggle.disabled = false;
                aiToggle.style.opacity = 1;
            }
        }

        function addCountrySelect() {
            if (countryCount >= maxCountries || aiToggle.checked) return;
            countryCount++;
            const label = document.createElement("label");
            label.textContent = `Country ${countryCount}:`;
            const select = document.createElement("select");
            select.name = `country${countryCount}`;
            select.required = true;
            const firstSelect = document.querySelector("select[name='country1']");
            select.innerHTML = firstSelect.innerHTML;
            container.appendChild(label);
            container.appendChild(select);
            updateAIStatus();
        }

        function removeCountrySelect() {
            if (countryCount <= 1) return;
            for (let i = 0; i < 2; i++) {
                container.removeChild(container.lastElementChild);
            }
            countryCount--;
            updateAIStatus();
        }

        aiToggle.addEventListener("change", () => {
            if (aiToggle.checked) {
                yearEndSelect.value = "2023";
                yearEndSelect.disabled = true;
                addBtn.disabled = true;
                addBtn.style.opacity = 0.5;
            } else {
                yearEndSelect.disabled = false;
                addBtn.disabled = false;
                addBtn.style.opacity = 1;
            }
        });

        document.getElementById("main-form").addEventListener("submit", function (e) {
            const yearEnd = yearEndSelect.value;
            const countryId = document.querySelector("select[name='country1']").value;
            const isChecked = aiToggle.checked;

            if (isChecked && yearEnd === "2023" && countryId !== "") {
                e.preventDefault();
                window.location.href = `/predict?country_id=${countryId}`;
            }
        });

        updateAIStatus(); // Iniziale
    </script>
</body>
</html>
